{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { message, Modal } from \"antd\";\nimport { useEffect, useState } from \"react\";\nimport { initGameDatas } from \"../../lib/initData\";\nexport const useGameHook = () => {\n  _s();\n\n  const [currentPlayer, setCurrentPlayer] = useState(\"Block\");\n  const [settingDatas, setSettingDatas] = useState([3, 5, 7]);\n  const [initGames, setInitGames] = useState(initGameDatas(settingDatas));\n  const [gamesDatas, setGamesDatas] = useState(initGames);\n  const [currentAllowSetPieceLine, setCurrentAllowSetPieceLine] = useState(-1);\n  const [gamesFinish, setGamesFinish] = useState(false);\n  const [currentChoosePiece, setCurrentChoosePiece] = useState([]);\n\n  const handleClickChangeCurrentPlayer = () => {\n    if (!currentChoosePiece.length) {\n      message.info(\"请走棋\");\n      return;\n    }\n\n    const player = currentPlayer === \"White\" ? \"Block\" : \"White\";\n    setCurrentPlayer(player);\n    setCurrentAllowSetPieceLine(-1);\n    setCurrentChoosePiece([]);\n  };\n\n  useEffect(() => {\n    let Datas = gamesDatas.flat(Infinity);\n    const gamesFinishFlag = Datas.reduce((arr, item) => {\n      return arr && item.disable;\n    }, true);\n\n    if (gamesFinishFlag) {\n      const player = currentPlayer === \"White\" ? \"Block\" : \"White\";\n      Modal.success({\n        title: \"游戏结束\",\n        content: `${player}获胜`\n      });\n    }\n  }, [gamesDatas]);\n  useEffect(() => {\n    setInitGames(initGameDatas(settingDatas));\n    resetInitGamesDatas();\n  }, [settingDatas, initGames]); // useEffect(() => {\n  //   resetInitGamesDatas();\n  // }, [initGames]);\n\n  const resetInitGamesDatas = () => {\n    setGamesDatas(initGames);\n    setCurrentPlayer(\"Block\");\n    setCurrentAllowSetPieceLine(-1);\n  };\n\n  const handleClickBox = box => {\n    if (noAllowSetPiece(box)) {\n      return;\n    }\n\n    setPiece(box);\n  };\n\n  const noAllowSetPiece = box => {\n    if (currentAllowSetPieceLine > -1 && box.line !== currentAllowSetPieceLine || box.disable) {\n      return true;\n    }\n\n    setCurrentAllowSetPieceLine(box.line);\n    return false;\n  };\n\n  const setPiece = box => {\n    const {\n      line,\n      row\n    } = box;\n    setCurrentChoosePiece([...currentChoosePiece, box]);\n    setGamesDatas(item => {\n      const _item = JSON.parse(JSON.stringify(item));\n\n      _item[line][row].disable = true;\n      _item[line][row].currentPlayer = currentPlayer;\n      return _item;\n    });\n  };\n\n  const handleClickReset = () => {\n    Modal.confirm({\n      content: `确认重玩么？`,\n      okText: \"重玩\",\n      cancelText: \"取消\",\n      onOk: () => {\n        resetInitGamesDatas();\n      },\n      onCancel: () => {}\n    });\n  };\n\n  const handleClickSetting = () => {\n    resetInitGamesDatas();\n  };\n\n  return {\n    handleClickChangeCurrentPlayer,\n    currentPlayer,\n    setCurrentPlayer,\n    gamesDatas,\n    handleClickBox,\n    gamesFinish,\n    handleClickReset,\n    handleClickSetting,\n    settingDatas,\n    setSettingDatas\n  };\n};\n\n_s(useGameHook, \"PewG35VwJCYGAm2tGKXOC6Ovr4c=\");","map":{"version":3,"sources":["/Users/tangchenlong/Desktop/react-demo/react-admin-demos/src/components/games/hook.tsx"],"names":["message","Modal","useEffect","useState","initGameDatas","useGameHook","currentPlayer","setCurrentPlayer","settingDatas","setSettingDatas","initGames","setInitGames","gamesDatas","setGamesDatas","currentAllowSetPieceLine","setCurrentAllowSetPieceLine","gamesFinish","setGamesFinish","currentChoosePiece","setCurrentChoosePiece","handleClickChangeCurrentPlayer","length","info","player","Datas","flat","Infinity","gamesFinishFlag","reduce","arr","item","disable","success","title","content","resetInitGamesDatas","handleClickBox","box","noAllowSetPiece","setPiece","line","row","_item","JSON","parse","stringify","handleClickReset","confirm","okText","cancelText","onOk","onCancel","handleClickSetting"],"mappings":"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","sourcesContent":["import { message, Modal } from \"antd\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { gameDatas, initGameDatas } from \"../../lib/initData\";\nimport { IBox, IPlayer } from \"../../type/types\";\n\nexport const useGameHook = () => {\n  const [currentPlayer, setCurrentPlayer] = useState(\"Block\");\n  const [settingDatas, setSettingDatas] = useState([3, 5, 7]);\n  const [initGames, setInitGames] = useState(initGameDatas(settingDatas));\n  const [gamesDatas, setGamesDatas] = useState(initGames);\n  const [currentAllowSetPieceLine, setCurrentAllowSetPieceLine] = useState(-1);\n  const [gamesFinish, setGamesFinish] = useState(false);\n  const [currentChoosePiece, setCurrentChoosePiece] = useState(\n    [] as Array<IBox>\n  );\n\n  const handleClickChangeCurrentPlayer = () => {\n    if (!currentChoosePiece.length) {\n      message.info(\"请走棋\");\n      return;\n    }\n    const player = currentPlayer === \"White\" ? \"Block\" : \"White\";\n    setCurrentPlayer(player);\n    setCurrentAllowSetPieceLine(-1);\n    setCurrentChoosePiece([]);\n  };\n\n  useEffect(() => {\n    let Datas: any = gamesDatas.flat(Infinity);\n    const gamesFinishFlag = Datas.reduce((arr: any, item: IBox) => {\n      return arr && item.disable;\n    }, true);\n    if (gamesFinishFlag) {\n      const player = currentPlayer === \"White\" ? \"Block\" : \"White\";\n      Modal.success({\n        title: \"游戏结束\",\n        content: `${player}获胜`,\n      });\n    }\n  }, [gamesDatas]);\n\n  useEffect(() => {\n    setInitGames(initGameDatas(settingDatas));\n    resetInitGamesDatas();\n  }, [settingDatas, initGames]);\n\n  // useEffect(() => {\n  //   resetInitGamesDatas();\n  // }, [initGames]);\n\n  const resetInitGamesDatas = () => {\n    setGamesDatas(initGames);\n    setCurrentPlayer(\"Block\");\n    setCurrentAllowSetPieceLine(-1);\n  };\n\n  const handleClickBox = (box: IBox) => {\n    if (noAllowSetPiece(box)) {\n      return;\n    }\n    setPiece(box);\n  };\n\n  const noAllowSetPiece = (box: IBox) => {\n    if (\n      (currentAllowSetPieceLine > -1 &&\n        box.line !== currentAllowSetPieceLine) ||\n      box.disable\n    ) {\n      return true;\n    }\n    setCurrentAllowSetPieceLine(box.line);\n    return false;\n  };\n\n  const setPiece = (box: IBox) => {\n    const { line, row } = box;\n    setCurrentChoosePiece([...currentChoosePiece, box]);\n    setGamesDatas((item) => {\n      const _item = JSON.parse(JSON.stringify(item));\n      _item[line][row].disable = true;\n      _item[line][row].currentPlayer = currentPlayer as IPlayer;\n      return _item;\n    });\n  };\n\n  const handleClickReset = () => {\n    Modal.confirm({\n      content: `确认重玩么？`,\n      okText: \"重玩\",\n      cancelText: \"取消\",\n      onOk: () => {\n        resetInitGamesDatas();\n      },\n      onCancel: () => {},\n    });\n  };\n\n  const handleClickSetting = () => {\n    resetInitGamesDatas();\n  };\n\n  return {\n    handleClickChangeCurrentPlayer,\n    currentPlayer,\n    setCurrentPlayer,\n    gamesDatas,\n    handleClickBox,\n    gamesFinish,\n    handleClickReset,\n    handleClickSetting,\n    settingDatas,\n    setSettingDatas,\n  };\n};\n"]},"metadata":{},"sourceType":"module"}